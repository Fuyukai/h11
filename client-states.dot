digraph {
  IDLE [label="IDLE\nstart state"]
  IDLE -> SEND_BODY [label="Request"]
  SEND_BODY -> SEND_BODY [label="Data"]
  SEND_BODY -> DONE [label="EndOfMessage"]

  DONE -> CLOSED [label="ConnectionClosed"]
  MUST_CLOSE -> CLOSED [label="ConnectionClosed"]
  IDLE -> CLOSED [label="ConnectionClosed"]

  IDLE -> MUST_CLOSE [label=<<i>Server state is CLOSED</i>>]
  DONE -> MUST_CLOSE [label=<<i>Server state is CLOSED</i>>]
  DONE -> MUST_CLOSE [label=<<i>Keep-alive disabled</i>>]

  DONE -> MIGHT_SWITCH_PROTOCOL [label=<<i>Requested Upgrade: or CONNECT</i>>]
  MIGHT_SWITCH_PROTOCOL -> DONE [label=<<i>Server state is SEND_BODY</i>>]
  MIGHT_SWITCH_PROTOCOL -> SWITCHED_PROTOCOL [
     label=<<i>Server state is SWITCHED_PROTOCOL</i>>]

  DONE -> IDLE [label=<<i>prepare_to_reuse()</i>>]
}
