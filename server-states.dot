digraph {
  IDLE [label="IDLE\ninitial state"]
  IDLE -> SEND_RESPONSE [label="InformationalResponse"]
  IDLE -> SEND_BODY [label="Response"]
  SEND_RESPONSE -> SEND_RESPONSE [label="InformationalResponse"]
  SEND_RESPONSE -> SEND_BODY [label="Response"]
  SEND_BODY -> SEND_BODY [label="Data"]
  SEND_BODY -> DONE [label="EndOfMessage"]

  DONE -> CLOSED [label="ConnectionClosed"]
  MUST_CLOSE -> CLOSED [label="ConnectionClosed"]
  IDLE -> CLOSED [label="ConnectionClosed"]

  IDLE -> MUST_CLOSE [label=<<i>peer state is CLOSED</i>>]
  DONE -> MUST_CLOSE [label=<<i>peer state is CLOSED</i>>]
  DONE -> MUST_CLOSE [label=<<i>keep-alive disabled</i>>]

  DONE -> SWITCHED

  DONE -> IDLE [label="prepare_to_reuse()", weight=0]
}
